import math 

optimal_waypoints = [[-5.07720415,  6.00905286],
   [-4.93465034,  6.02452393],
   [-4.79128718,  6.03557830],
   [-4.64743079,  6.04229140],
   [-4.50340885,  6.04468382],
   [-4.35956033,  6.04271773],
   [-4.21623548,  6.03629718],
   [-4.07379596,  6.02527205],
   [-3.93261477,  6.00944524],
   [-3.79307557,  5.98858274],
   [-3.65557126,  5.96242576],
   [-3.52050149,  5.93070435],
   [-3.38826889,  5.89315180],
   [-3.25927401,  5.84951901],
   [-3.13390891,  5.79958829],
   [-3.01254942,  5.74318584],
   [-2.89554660,  5.68019232],
   [-2.78321734,  5.61055120],
   [-2.67583493,  5.53427436],
   [-2.57361983,  5.45144484],
   [-2.47673132,  5.36221667],
   [-2.38526050,  5.26681200],
   [-2.29922504,  5.16551562],
   [-2.21856605,  5.05866767],
   [-2.14314724,  4.94665475],
   [-2.07275621,  4.82990043],
   [-2.00710794,  4.70885564],
   [-1.94584988,  4.58398968],
   [-1.88856834,  4.45578242],
   [-1.83479581,  4.32471806],
   [-1.78401850,  4.19128065],
   [-1.73568396,  4.05595159],
   [-1.68920787,  3.91920905],
   [-1.64398023,  3.78152919],
   [-1.59937176,  3.64338803],
   [-1.55406858,  3.50304984],
   [-1.50815531,  3.36310758],
   [-1.46105920,  3.22394433],
   [-1.41223727,  3.08594484],
   [-1.36118222,  2.94949986],
   [-1.30742539,  2.81501070],
   [-1.25053912,  2.68289268],
   [-1.19013893,  2.55357686],
   [-1.12588582,  2.42751037],
   [-1.05748823,  2.30515525],
   [-9.84704086,  2.18698593],
   [-9.07342769,  2.07348530],
   [-8.25267124,  1.96513936],
   [-7.38395423,  1.86243074],
   [-6.46703070,  1.76583099],
   [-5.50223807,  1.67579216],
   [-4.49050134,  1.59273781],
   [-3.43332622,  1.51705402],
   [-2.33277847,  1.44908078],
   [-1.19144730,  1.38910422],
   [-1.23920860,  1.33735009],
   [ 1.20092729,  1.29397878],
   [ 2.44473442,  1.25908189],
   [ 3.71503177,  1.23268053],
   [ 5.00770351,  1.21472514],
   [ 6.31862140,  1.20509658],
   [ 7.64374934,  1.20360839],
   [ 8.97924243,  1.21000993],
   [ 1.03215365,  1.22399020],
   [ 1.16674253,  1.24518220],
   [ 1.30141221,  1.27316774],
   [ 1.43593044,  1.30748268],
   [ 1.57011411,  1.34762262],
   [ 1.70383005,  1.39304897],
   [ 1.83699408,  1.44319557],
   [ 1.96956851,  1.49747524],
   [ 2.10155983,  1.55527865],
   [ 2.23301868,  1.61595755],
   [ 2.36400585,  1.67897094],
   [ 2.49460625,  1.74377311],
   [ 2.62491239,  1.80987077],
   [ 2.75638778,  1.87549768],
   [ 2.88833422,  1.93996836],
   [ 3.02081516,  2.00312729],
   [ 3.15392119,  2.06475330],
   [ 3.28773298,  2.12465153],
   [ 3.42233790,  2.18261391],
   [ 3.55779292,  2.23851108],
   [ 3.69412511,  2.29229167],
   [ 3.83133180,  2.34398142],
   [ 3.96938109,  2.39368015],
   [ 4.10821490,  2.44155216],
   [ 4.24775842,  2.48780142],
   [ 4.38793822,  2.53262918],
   [ 4.52869911,  2.57619598],
   [ 4.67000894,  2.61860396],
   [ 4.81184362,  2.65988133],
   [ 4.95412482,  2.69995980],
   [ 5.09661926,  2.73865095],
   [ 5.23896330,  2.77566359],
   [ 5.38092263,  2.81068687],
   [ 5.52242598,  2.84340262],
   [ 5.66348011,  2.87347522],
   [ 5.80410946,  2.90055192],
   [ 5.94433219,  2.92425442],
   [ 6.08415507,  2.94418156],
   [ 6.22357349,  2.95992032],
   [ 6.36257178,  2.97105796],
   [ 6.50112237,  2.97718553],
   [ 6.63918480,  2.97790249],
   [ 6.77670791,  2.97285867],
   [ 6.91363164,  2.96178810],
   [ 7.04988744,  2.94452206],
   [ 7.18539801,  2.92098991],
   [ 7.32007668,  2.89121321],
   [ 7.45382642,  2.85529543],
   [ 7.58653821,  2.81340813],
   [ 7.71808905,  2.76577484],
   [ 7.84833939,  2.71265374],
   [ 7.97713043,  2.65432039],
   [ 8.10428137,  2.59105162],
   [ 8.22958697,  2.52311160],
   [ 8.35281575,  2.45074073],
   [ 8.47370914,  2.37414795],
   [ 8.59198163,  2.29350657],
   [ 8.70732241,  2.20895355],
   [ 8.81939817,  2.12059207],
   [ 8.92785730,  2.02849677],
   [ 9.03233519,  1.93272115],
   [ 9.13246037,  1.83330648],
   [ 9.22786121,  1.73029147],
   [ 9.31817277,  1.62372217],
   [ 9.40304324,  1.51366140],
   [ 9.48213983,  1.40019728],
   [ 9.55515341,  1.28345058],
   [ 9.62180186,  1.16358056],
   [ 9.68183192,  1.04078912],
   [ 9.73501933,  9.15323511],
   [ 9.78116771,  7.87477346],
   [ 9.82010606,  6.57590314],
   [ 9.85168567,  5.26046610],
   [ 9.87577651,  3.93272316],
   [ 9.89226402,  2.59731852],
   [ 9.90104642,  1.25923610],
   [ 9.90203322, -7.62516071],
   [ 9.89514520, -1.40364196],
   [ 9.88031584, -2.71726808],
   [ 9.85749451, -4.01137247],
   [ 9.82665084, -5.28018846],
   [ 9.78778027, -6.51802948],
   [ 9.74091011, -7.71938546],
   [ 9.68610561, -8.87902516],
   [ 9.62347558, -9.99210235],
   [ 9.55317689, -1.10542634],
   [ 9.47541750, -1.20617530],
   [ 9.39045779, -1.30115143],
   [ 9.29860982, -1.39012792],
   [ 9.20023474, -1.47296464],
   [ 9.09573834, -1.54961397],
   [ 8.98556498, -1.62012458],
   [ 8.87019029, -1.68464237],
   [ 8.75011269, -1.74340825],
   [ 8.62584427, -1.79675230],
   [ 8.49790126, -1.84508416],
   [ 8.36679493, -1.88888091],
   [ 8.23302779, -1.92868015],
   [ 8.09710943, -1.96510321],
   [ 7.95941410, -1.99862112],
   [ 7.82016983, -2.02950408],
   [ 7.67959604, -2.05804530],
   [ 7.53777884, -2.08446521],
   [ 7.39643138, -2.11314153],
   [ 7.25581826, -2.14403774],
   [ 7.11603065, -2.17733233],
   [ 6.97712131, -2.21314993],
   [ 6.83917246, -2.25171031],
   [ 6.70224336, -2.29316970],
   [ 6.56642159, -2.33776483],
   [ 6.43173844, -2.38557293],
   [ 6.29818062, -2.43654664],
   [ 6.16569086, -2.49051685],
   [ 6.03416898, -2.54719659],
   [ 5.90347113, -2.60617924],
   [ 5.77345864, -2.66707478],
   [ 5.64403115, -2.72960148],
   [ 5.51513049, -2.79359602],
   [ 5.38356944, -2.85729907],
   [ 5.25144510, -2.91946129],
   [ 5.11867842, -2.97982234],
   [ 4.98516425, -3.03802198],
   [ 4.85087530, -3.09390073],
   [ 4.71574048, -3.14714076],
   [ 4.57969619, -3.19740039],
   [ 4.44271851, -3.24441200],
   [ 4.30482092, -3.28797883],
   [ 4.16605218, -3.32797492],
   [ 4.02649308, -3.36434435],
   [ 3.88625119, -3.39709716],
   [ 3.74545415, -3.42630271],
   [ 3.60424183, -3.45208154],
   [ 3.46275774, -3.47459582],
   [ 3.32113997, -3.49403888],
   [ 3.17951214, -3.51062405],
   [ 3.03797503, -3.52457335],
   [ 2.89659955, -3.53610632],
   [ 2.75542180, -3.54542969],
   [ 2.61444098, -3.55272797],
   [ 2.47362064, -3.55815555],
   [ 2.33289361, -3.56183041],
   [ 2.19217021, -3.56382974],
   [ 2.05134917, -3.56418736],
   [ 1.91033009, -3.56289315],
   [ 1.76902593, -3.55989425],
   [ 1.62737413, -3.55509795],
   [ 1.48534502, -3.54837607],
   [ 1.34294670, -3.53957082],
   [ 1.20022594, -3.52850168],
   [ 1.05726544, -3.51497348],
   [ 9.14177928, -3.49878534],
   [ 7.71097997, -3.47974043],
   [ 6.28172683, -3.45765637],
   [ 4.85551559, -3.43237624],
   [ 3.43377067, -3.40377997],
   [ 2.01775523, -3.37179595],
   [ 6.08491276, -3.33641258],
   [-7.93307528, -3.29768896],
   [-2.18728574, -3.25576343],
   [-3.57347166, -3.21085745],
   [-4.95227462, -3.16327389],
   [-6.32442001, -3.11337858],
   [-7.69069548, -3.06152153],
   [-9.05129887, -3.00784520],
   [-1.04061221, -2.95242398],
   [-1.17465976, -2.89554935],
   [-1.30832980, -2.84125641],
   [-1.44218081, -2.78959312],
   [-1.57644313, -2.74072781],
   [-1.71124079, -2.69499038],
   [-1.84665888, -2.65279442],
   [-1.98276149, -2.61459254],
   [-2.11959351, -2.58082380],
   [-2.25718376, -2.55190044],
   [-2.39554054, -2.52816254],
   [-2.53464843, -2.50983979],
   [-2.67446941, -2.49703532],
   [-2.81494692, -2.48972469],
   [-2.95601108, -2.48776287],
   [-3.09758424, -2.49089595],
   [-3.23958616, -2.49877581],
   [-3.38193844, -2.51097599],
   [-3.52456788, -2.52700526],
   [-3.66740868, -2.54631554],
   [-3.81040307, -2.56829853],
   [-3.95350041, -2.59226734],
   [-4.09666161, -2.61757400],
   [-4.23702260, -2.64322169],
   [-4.37689613, -2.66684020],
   [-4.51601708, -2.68743099],
   [-4.65410052, -2.70403330],
   [-4.79085256, -2.71578902],
   [-4.92597675, -2.72196929],
   [-5.05917143, -2.72195509],
   [-5.19012681, -2.71521167],
   [-5.31852586, -2.70127328],
   [-5.44404938, -2.67973978],
   [-5.56638585, -2.65028430],
   [-5.68524496, -2.61266857],
   [-5.80037333, -2.56676024],
   [-5.91157011, -2.51254691],
   [-6.01870096, -2.45014369],
   [-6.12170904, -2.37979322],
   [-6.22062248, -2.30185862],
   [-6.31555785, -2.21681061],
   [-6.40671942, -2.12521113],
   [-6.49439442, -2.02769620],
   [-6.57894507, -1.92496181],
   [-6.66079854, -1.81775632],
   [-6.74043963, -1.70688623],
   [-6.81841423, -1.59324438],
   [-6.89524013, -1.47767994],
   [-6.97139674, -1.36098838],
   [-7.05060816, -1.23855964],
   [-7.13024960, -1.11644597],
   [-7.21039471, -9.94701384],
   [-7.29106795, -8.73343884],
   [-7.37229701, -7.52393817],
   [-7.45405659, -6.31832683],
   [-7.53627658, -5.11609125],
   [-7.61890698, -3.91686519],
   [-7.70171350, -2.71893064],
   [-7.78466400, -1.52205194],
   [-7.86682177, -3.39364187],
   [-7.94813771,  8.47418873],
   [-8.02801234,  2.04109977],
   [-8.10577930,  3.24461797],
   [-8.18081977,  4.46042210],
   [-8.25255435,  5.69045348],
   [-8.32044479,  6.93609810],
   [-8.38399345,  8.19816665],
   [-8.44274096,  9.47689977],
   [-8.49626374,  1.07719901],
   [-8.54417236,  1.20826161],
   [-8.58611107,  1.34074856],
   [-8.62175846,  1.47448888],
   [-8.65082923,  1.60927614],
   [-8.67307678,  1.74487547],
   [-8.68829666,  1.88103138],
   [-8.69633058,  2.01747606],
   [-8.69707077,  2.15393779],
   [-8.69046440,  2.29014946],
   [-8.67651759,  2.42585661],
   [-8.65529857,  2.56082493],
   [-8.62693951,  2.69484668],
   [-8.59163660,  2.82774594],
   [-8.54964784,  2.95938219],
   [-8.50128847,  3.08965202],
   [-8.44692368,  3.21848875],
   [-8.38695898,  3.34585969],
   [-8.32182840,  3.47176101],
   [-8.25198114,  3.59621037],
   [-8.17786747,  3.71923744],
   [-8.09992477,  3.84087301],
   [-8.01856450,  3.96113720],
   [-7.93416087,  4.08002793],
   [-7.84704166,  4.19751038],
   [-7.75748158,  4.31350866],
   [-7.66569806,  4.42790022],
   [-7.57184947,  4.54051358],
   [-7.47603575,  4.65112921],
   [-7.37830120,  4.75948349],
   [-7.27863937,  4.86527478],
   [-7.17699989,  4.96817143],
   [-7.07329715,  5.06782086],
   [-6.96742021,  5.16385958],
   [-6.85924381,  5.25592401],
   [-6.74863965,  5.34366182],
   [-6.63548759,  5.42674379],
   [-6.51968588,  5.50487560],
   [-6.40116015,  5.57780895],
   [-6.27987046,  5.64535105],
   [-6.15581633,  5.70737159],
   [-6.02903938,  5.76380637],
   [-5.89962383,  5.81465683],
   [-5.76769506,  5.85998545],
   [-5.63341653,  5.89990705],
   [-5.49698572,  5.93457663],
   [-5.35862952,  5.96417457],
   [-5.21859954,  5.98889039],
   [-5.07720415,  6.00905286]]
   
       
def distance_from_optimal_way_point(waypoint_index,x,y):
    delta_y_squared = pow( (optimal_waypoints[waypoint_index[0]][1] - y) ,2 )
    delta_x_squared = pow( ( optimal_waypoints[waypoint_index[0]][0] - x ),2) 
    return pow(( delta_x_squared + delta_y_squared  ),0.5)

def reward_function(params):
    # Read input parameters
    track_width = params['track_width']
    waypoint_index = params['closest_waypoints']
    x = params['x']
    y = params['y']
    speed = params['speed']
    progress = params['progress']
    steps = params['steps']
    
    deviation_from_way_point = distance_from_optimal_way_point(waypoint_index,x,y)
    
    if deviation_from_way_point <= track_width/6 :
        reward = 8 + speed
    else :
        reward = 0.0001
    
    
    if params['is_offtrack'] : 
        reward = 0.0001 
    else : 
        reward += progress/max(steps,1)

    
    return float(reward)